# BENCH
Bayesian EstimatioN of CHange

## What is it?
BENCH is a toolbox for identifying and estimating changes in parameters of a biophysical model between two groups of data (e.g. patients and controls). It is an alternative for model inversion, that is estimating the parameters for each group separately and compare the estimations. The advantage is that BENCH allows for using over parameterised models where the model inversion approaches fail because of parameter degeneraceis. Currently, BENCH only supports microstructural models for diffusion MRI, but it is extendable to other domains.    

## When it is useful?
Bench is usful when the aim is comparing two groups of data in terms of parameters of a biophysical model; but not estimating the parameters pre.se. It is particularly advantagous when the model has more free parameters than what can be estimated given the measurements.  

## How it works?
Using simulated data, we generate models of change that can predict how a baseline measurement changes if any of the parameters of the model changes. Then, in a bayesian framework, we estimate which of the `` change models'' can better explain the observed change between two groups. FOr more details, please refer to the paper(link). 


## How to install it?
Here are the steps to install BENCH: 

1. clone the project from github. 
2. open a command line and ``cd`` to the downloded directory (that contains setup.py file)
3. run ``python setup.py install`` 

## What are the required inputs?
As bench is an alternative to model fitting, anything that is needed to fit models to two groups is needed for bench as well. Currently, bench only supports diffusion MRI data and microstructural models. This includes:

1. Preprocessed diffusion data for each subject in two groups. 
2. Transformations from native diffusion space to a standard structual space, e.g. MNI.
3. A ROI mask in the standard space that defines voxels to analyse. 
4. b-value and b-vec files. (the same format as accepted in FDT)
5. Design.mat and contranst.mat files generated by Glm_gui. (refer to glm section below)

## How to use it?
BENCH runs in multiple steps that are explained as follows:
- Train change models:
 This step is for taining change models for parameters of a specific biophysical model with a given acquisition protocol. It doesnt require any data, and once the training is done the models can be used with any data with the same acquisition protocol. Generally, this step requires a forward model that can map parameters to measurements and prior distribution for each of them. Currently a few forward models have been implemented. Please refer to the paper for the details about the forward model and the priors for the parameters. You can add your model or update the priors in the [diffusion_models.py](bench/diffusion_models.py). 

 To train models of change you need to run the following command:

```
bench diff-train --model <model_name> --bval <path_to_bvalue_file> --output <name_of_output_file>
```

run `` bench diff-train --help`` to see the full list of optional parameters. This command generates a pickle file that contains trained machine learning models.


- Compute the summary measurements:


- GLM:

- Inference:


## What are the outputs?

